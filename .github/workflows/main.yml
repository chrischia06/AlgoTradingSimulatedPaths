on:
  push:
    branches: 
      - main 
      - chris-experiments2

jobs:
  build:
    name: Run Python Script
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: 3.7
      - name: install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas
      - name: run script
        uses: jannekem/run-python-script-action@v1
        with:
          script: |
            import os
            import pandas
            result = pandas.DataFrame()
            for f in os.listdir("logs"):
              if f[-3:] == 'txt':
                temp = pandas.read_csv(f"logs/{f}")
                temp["description"] = f
                result = pandas.concat([result, temp])
            result.to_csv("logs/results.csv", index=False)
            result2 = result.apply(lambda x: round(x, 4) if x.dtype != "object" else x)
            result2["Median Max Drawdown Duration"] = result2["Median Max Drawdown Duration"].apply(lambda x: round(x, 1))
            columns = ['hyperparams', 'Mean RT', 'Var RT', 'Skew RT','Kurt RT', 'Lambda']
            result3 = result2.set_index('description')
            result3[columns].to_latex('result_latex2.txt')
      - name: Commit rendered files
        run: |
          git config --global user.name "bot"
          git add logs/*
          git commit -m "Update backtest log" || echo "No changes to commit"
          git push origin main || echo "No changes to commit"
